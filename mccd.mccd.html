

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>1.1.4. mccd.mccd module &mdash; mccd 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="1.1.5. mccd.mccd_utils module" href="mccd.mccd_utils.html" />
    <link rel="prev" title="1.1.3. mccd.info module" href="mccd.info.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> mccd
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="mccd.html">1. mccd package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mccd.auxiliary_fun.html">1.1.1. mccd.auxiliary_fun module</a></li>
<li class="toctree-l2"><a class="reference internal" href="mccd.grads.html">1.1.2. mccd.grads module</a></li>
<li class="toctree-l2"><a class="reference internal" href="mccd.info.html">1.1.3. mccd.info module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.1.4. mccd.mccd module</a></li>
<li class="toctree-l2"><a class="reference internal" href="mccd.mccd_utils.html">1.1.5. mccd.mccd_utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="mccd.proxs.html">1.1.6. mccd.proxs module</a></li>
<li class="toctree-l2"><a class="reference internal" href="mccd.utils.html">1.1.7. mccd.utils module</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mccd</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="mccd.html"><span class="section-number">1. </span>mccd package</a> &raquo;</li>
        
      <li><span class="section-number">1.1.4. </span>mccd.mccd module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/mccd.mccd.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-mccd.mccd">
<span id="mccd-mccd-module"></span><h1><span class="section-number">1.1.4. </span>mccd.mccd module<a class="headerlink" href="#module-mccd.mccd" title="Permalink to this headline">¶</a></h1>
<p>MCCD CLASS.</p>
<p>This module contains the main MCCD class.</p>
<dl class="field-list">
<dt class="field-odd">Authors</dt>
<dd class="field-odd"><p>Tobias Liaudat &lt;<a class="reference external" href="mailto:tobias&#46;liaudat&#37;&#52;&#48;cea&#46;fr">tobias<span>&#46;</span>liaudat<span>&#64;</span>cea<span>&#46;</span>fr</a>&gt;</p>
<p>Jerome Bonnin &lt;<a class="reference external" href="https://github.com/jerome-bonnin">https://github.com/jerome-bonnin</a>&gt;</p>
<p>Morgan Schmitz &lt;<a class="reference external" href="https://github.com/MorganSchmitz">https://github.com/MorganSchmitz</a>&gt;</p>
</dd>
</dl>
<dl class="py function">
<dt id="mccd.mccd.mccd_quickload">
<code class="sig-prename descclassname"><span class="pre">mccd.mccd.</span></code><code class="sig-name descname"><span class="pre">mccd_quickload</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mccd/mccd.html#mccd_quickload"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mccd.mccd.mccd_quickload" title="Permalink to this definition">¶</a></dt>
<dd><p>Load pre-fitted MCCD model.</p>
<p>(saved with <code class="xref py py-func docutils literal notranslate"><span class="pre">mccd.quicksave()</span></code>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – Path to the npy file containing the saved MCCD model.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>loaded_model</strong> – The MCCD model.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>MCCD class</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="mccd.mccd.MCCD">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">mccd.mccd.</span></code><code class="sig-name descname"><span class="pre">MCCD</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_comp_loc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d_comp_glob</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upfact</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ksig_loc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ksig_glob</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_scales</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ksig_init</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mccd/mccd.html#MCCD"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mccd.mccd.MCCD" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Multi-CCD Resolved Components Analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_comp_loc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of components to learn for each CCD.
The interpretation may depend on the <code class="docutils literal notranslate"><span class="pre">loc_model</span></code>
parameter of the <a class="reference internal" href="#mccd.mccd.MCCD.fit" title="mccd.mccd.MCCD.fit"><code class="xref py py-func docutils literal notranslate"><span class="pre">fit()</span></code></a> function.</p></li>
<li><p><strong>d_comp_glob</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Degree of polynomial components for the global model.</p></li>
<li><p><strong>upfact</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Upsampling factor. Default is 1 (no superresolution).</p></li>
<li><p><strong>ksig_loc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – Value of <span class="math notranslate nohighlight">\(K_{\sigma}^{Loc}\)</span> for the thresholding in
wavelet (Starlet by default) domain (taken to be
<span class="math notranslate nohighlight">\(K\sigma\)</span>, where <span class="math notranslate nohighlight">\(\sigma\)</span> is the estimated noise standard
deviation.). It is used for the thresholding of the
local eigenPSF <span class="math notranslate nohighlight">\(S_{K}\)</span> update.
Default is <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>ksig_glob</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – Value of <span class="math notranslate nohighlight">\(K_{\sigma}^{Glob}\)</span> for the thresholding in Starlet
domain (taken to be <span class="math notranslate nohighlight">\(k\sigma\)</span>, where <span class="math notranslate nohighlight">\(\sigma\)</span> is the
estimated noise standard deviation.).
It is used for the thresholding of the
global eigenPSF <span class="math notranslate nohighlight">\(\tilde{S}\)</span> update.
Default is <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>n_scales</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of wavelet (Default Starlet) scales to use for the
sparsity constraint.
Default is <code class="docutils literal notranslate"><span class="pre">3</span></code>. Unused if <code class="docutils literal notranslate"><span class="pre">filters</span></code> are provided.</p></li>
<li><p><strong>ksig_init</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – Similar to <code class="docutils literal notranslate"><span class="pre">ksig</span></code>, for use when estimating shifts and noise levels,
as it might be desirable to have it set higher than <code class="docutils literal notranslate"><span class="pre">ksig</span></code>.
Unused if <code class="docutils literal notranslate"><span class="pre">shifts</span></code> are provided when running <code class="xref py py-func docutils literal notranslate"><span class="pre">RCA.fit()</span></code>.
Default is <code class="docutils literal notranslate"><span class="pre">5</span></code>.</p></li>
<li><p><strong>filters</strong> (<em>numpy.ndarray</em>) – Optional filters to the transform domain wherein eigenPSFs are
assumed to be sparse; convolution by them should amount to
applying <span class="math notranslate nohighlight">\(\Phi\)</span>. Optional; if not provided, the
Starlet transform with <cite>n_scales</cite> scales will be used.</p></li>
<li><p><strong>verbose</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – If True, will only output RCA-specific lines to stdout.
If verbose is set to 2, will run ModOpt’s optimization
algorithms in verbose mode.
Default to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
</ul>
</dd>
</dl>
<p>General parameter initialisations.</p>
<dl class="py method">
<dt id="mccd.mccd.MCCD.quicksave">
<code class="sig-name descname"><span class="pre">quicksave</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mccd/mccd.html#MCCD.quicksave"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mccd.mccd.MCCD.quicksave" title="Permalink to this definition">¶</a></dt>
<dd><p>Save fitted model.</p>
<p>Save fitted MCCD model for later use. Ideally, you would probably
want to store the whole MCCD instance, though this might mean
storing a lot of data you are not likely to use if you do not alter
the fit that was already performed.
Stored models can be loaded with <code class="xref py py-func docutils literal notranslate"><span class="pre">mccd.mccd_quickload()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – Path to where the fitted MCCDF model should be saved.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mccd.mccd.MCCD.fit">
<code class="sig-name descname"><span class="pre">fit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ccd_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">SNR_weight_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">S</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VT</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Pi</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shifts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psf_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psf_size_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'R2'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_iter_glob</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_iter_loc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_subiter_S_loc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_reweight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_subiter_A_loc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">500</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_subiter_S_glob</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_subiter_A_glob</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_eigenvects</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loc_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'rca'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pi_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mccd/mccd.html#MCCD.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mccd.mccd.MCCD.fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Fits MCCD to observed star field.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs_data</strong> (<em>list of numpy.ndarray</em>) – Observed data (each element of the list being one CCD).</p></li>
<li><p><strong>obs_pos</strong> (<em>list of numpy.ndarray</em>) – Corresponding positions (global coordinate system).</p></li>
<li><p><strong>ccd_list</strong> (<em>list of numpy.ndarray</em>) – List containing the ccd_ids of each set of observations,
positions and weights.
It is of utmost importance that the ccd_list contains the ccd_id
in the same order as in the other lists.
Ex:  obs_data[0] is the data from the ccd ccd_list[0].</p></li>
<li><p><strong>obs_weights</strong> (<em>list of numpy.ndarray</em>) – Corresponding weights. Can be either one per observed star,
or contain pixel-wise values. Masks can be handled via binary
weights. Default is None (in which case no weights are applied).
Note if fluxes and shifts are not provided, weights will be ignored
for their estimation. Noise level estimation only removes
bad pixels (with weight strictly equal to 0) and otherwise
ignores weights.</p></li>
<li><p><strong>SNR_weight_list</strong> (<em>list of floats</em>) – List of weights to be used on each star. They can probably be based
on a specific function of the SNR and should represent the degree
of significance we give to a specific star.
The values should be around 1.
Default is <code class="docutils literal notranslate"><span class="pre">None</span></code> meaning that no weights will be used.</p></li>
<li><p><strong>S</strong> (<em>list of numpy.ndarray</em>) – First guess (or warm start) eigenPSFs <span class="math notranslate nohighlight">\(S\)</span>
(last matrix is global). Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>VT</strong> (<em>list of numpy.ndarray</em>) – Matrices of concatenated eigenvectors of the different
graph Laplacians. Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>Pi</strong> (<em>list of numpy.ndarray</em>) – Matrices of polynomials in positions. Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>alpha</strong> (<em>list numpy.ndarray</em>) – First guess (or warm start) weights <span class="math notranslate nohighlight">\(\alpha\)</span>,
after factorization by <code class="docutils literal notranslate"><span class="pre">VT</span></code> (last matrix is global).
Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>shifts</strong> (<em>list of numpy.ndarray</em>) – Corresponding sub-pixel shifts. Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>;
will be estimated from observed data if not provided.</p></li>
<li><p><strong>sigs</strong> (<em>numpy.ndarray</em>) – Estimated noise levels. Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>;
will be estimated from data if not provided.</p></li>
<li><p><strong>psf_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – Approximate expected PSF size in <code class="docutils literal notranslate"><span class="pre">psf_size_type</span></code>;
will be used for the size of the Gaussian window for centroid
estimation.
<code class="docutils literal notranslate"><span class="pre">psf_size_type</span></code> determines the convention used for
this size (default is FWHM).
Ignored if <code class="docutils literal notranslate"><span class="pre">shifts</span></code> are provided.
Default is <code class="docutils literal notranslate"><span class="pre">'R2'</span></code> of <code class="docutils literal notranslate"><span class="pre">6</span></code>.</p></li>
<li><p><strong>psf_size_type</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – Can be any of <code class="docutils literal notranslate"><span class="pre">'R2'</span></code>, <code class="docutils literal notranslate"><span class="pre">'fwhm'</span></code> or <code class="docutils literal notranslate"><span class="pre">'sigma'</span></code>, for the size
defined from quadrupole moments, full width at half maximum
(e.g. from SExtractor) or 1-sigma width of the best matching
2D Gaussian. <code class="docutils literal notranslate"><span class="pre">'sigma'</span></code> is the value outputed from Galsim’s
HSM adaptive moment estimator.
Default is <code class="docutils literal notranslate"><span class="pre">'R2'</span></code>.</p></li>
<li><p><strong>flux</strong> (<em>list of numpy.ndarray</em>) – Flux levels. Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>;
will be estimated from data if not provided.</p></li>
<li><p><strong>nb_iter</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of overall iterations (i.e. of alternations).
Note the weights and global components do not
get updated the last time around, so they actually get
<code class="docutils literal notranslate"><span class="pre">nb_iter-1</span></code> updates.
Paramter <span class="math notranslate nohighlight">\(l_{max}\)</span> on the MCCD article pseudo-algorithm.
Default is <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>nb_iter_glob</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of iterations on the global model estimation.
The times we go trough the global <span class="math notranslate nohighlight">\(S,A\)</span> updates.
Paramter <span class="math notranslate nohighlight">\(n_G\)</span> on the MCCD article pseudo-algorithm.
Default value is <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><strong>nb_iter_loc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of iterations on the local model estimation.
The times we go trough the local <span class="math notranslate nohighlight">\(S,A\)</span> updates.
Paramter <span class="math notranslate nohighlight">\(n_L\)</span> on the MCCD article pseudo-algorithm.
Default value is <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><strong>nb_subiter_S_loc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of iterations when solving the optimization problem (III)
concerning the local eigenPSFs <span class="math notranslate nohighlight">\(S_{k}\)</span>.
Default is <code class="docutils literal notranslate"><span class="pre">100</span></code>.</p></li>
<li><p><strong>nb_subiter_A_loc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of iterations when solving the optimization problem (IV)
concerning the local weights <span class="math notranslate nohighlight">\(\alpha_{k}\)</span>.
Default is <code class="docutils literal notranslate"><span class="pre">500</span></code>.</p></li>
<li><p><strong>nb_subiter_S_glob</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of iterations when solving the optimization problem (I)
concerning the global eigenPSFs <span class="math notranslate nohighlight">\(\tilde{S}\)</span>.
Default is <code class="docutils literal notranslate"><span class="pre">30</span></code>.</p></li>
<li><p><strong>nb_subiter_A_glob</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of iterations when solving the optimization problem (II)
concerning the global weights <span class="math notranslate nohighlight">\(\tilde{\alpha}\)</span>.
Default is <code class="docutils literal notranslate"><span class="pre">200</span></code>.</p></li>
<li><p><strong>nb_reweight</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of reweightings to apply during <span class="math notranslate nohighlight">\(S\)</span> updates.
See equation (33) in RCA paper.
Default is <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><strong>n_eigenvects</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Maximum number of eigenvectors to consider per <span class="math notranslate nohighlight">\((e,a)\)</span>
couple. Default is <code class="docutils literal notranslate"><span class="pre">None</span></code>;
if not provided, <em>all</em> eigenvectors will be considered,
which can lead to a poor selection of graphs, especially when data
is undersampled. Ignored if <code class="docutils literal notranslate"><span class="pre">VT</span></code> and <code class="docutils literal notranslate"><span class="pre">alpha</span></code> are provided.</p></li>
<li><p><strong>loc_model</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – Defines the type of local model to use, it can be:
<code class="docutils literal notranslate"><span class="pre">'rca'</span></code>, <code class="docutils literal notranslate"><span class="pre">'poly'</span></code> or <code class="docutils literal notranslate"><span class="pre">'hybrid'</span></code>.
Thus defining the MCCD-RCA, MCCD-POL and MCCD-HYB.
When MCCD-POL is used, <code class="docutils literal notranslate"><span class="pre">n_comp_loc</span></code> should be used
as the <code class="docutils literal notranslate"><span class="pre">d_comp_glob</span></code> (max degree of the polynomial)
for the local model.
When MCCD-HYB is used, <code class="docutils literal notranslate"><span class="pre">n_comp_loc</span></code> should be used
as in MCCD-RCA, the number of graph-based eigenPSFs.
The max local polynomial degree is set to <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><strong>pi_degree</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Maximum degree of polynomials in Pi. Default is <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Ignored if Pi is provided.</p></li>
<li><p><strong>graph_kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – List of optional kwargs to be passed on
to the <code class="xref py py-func docutils literal notranslate"><span class="pre">utils.GraphBuilder()</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mccd.mccd.MCCD.estimate_psf">
<code class="sig-name descname"><span class="pre">estimate_psf</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ccd_n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_loc_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_glob_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rbf_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'thin_plate'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_degradation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shifts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigmas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">upfact</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mccd_debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_pol_interp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mccd/mccd.html#MCCD.estimate_psf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mccd.mccd.MCCD.estimate_psf" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate and return PSF at desired positions.</p>
<p>Returns the model in “regular” format, (n_stars, n_pixels, n_pixels).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test_pos</strong> (<em>numpy.ndarray</em>) – Positions where the PSF should be estimated.
Should be in the same format (coordinate system, units, etc.) as
the <code class="docutils literal notranslate"><span class="pre">obs_pos</span></code> fed to <a class="reference internal" href="#mccd.mccd.MCCD.fit" title="mccd.mccd.MCCD.fit"><code class="xref py py-func docutils literal notranslate"><span class="pre">MCCD.fit()</span></code></a>.</p></li>
<li><p><strong>ccd_n</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – <code class="docutils literal notranslate"><span class="pre">ccd_id</span></code> of the positions to be tested.</p></li>
<li><p><strong>n_loc_neighbors</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of neighbors for the local model to use for RBF
interpolation. Default is 15.</p></li>
<li><p><strong>n_glob_neighbors</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Number of neighbors for the global model to use for RBF
interpolation. Default is 15.</p></li>
<li><p><strong>rbf_function</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – Type of RBF kernel to use. Default is <code class="docutils literal notranslate"><span class="pre">'thin_plate'</span></code>.
Check scipy RBF documentation for more models.</p></li>
<li><p><strong>apply_degradation</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Whether PSF model should be degraded (shifted and
resampled on coarse grid), for instance for comparison with stars.
If True, expects shifts to be provided.
Needed if pixel validation against stars will be required.
Default is False.</p></li>
<li><p><strong>shifts</strong> (<em>numpy.ndarray</em>) – Intra-pixel shifts to apply if <code class="docutils literal notranslate"><span class="pre">apply_degradation</span></code> is set
to True.
Needed to match the observed stars in case of pixel validation.</p></li>
<li><p><strong>flux</strong> (<em>numpy.ndarray</em>) – Flux levels by which reconstructed PSF will be multiplied if
provided. For pixel validation with stars if <code class="docutils literal notranslate"><span class="pre">apply_degradation</span></code>
is set to True.</p></li>
<li><p><strong>sigmas</strong> (<em>numpy.ndarray</em>) – Sigmas (shapes) are used to have a better estimate of the size
of the lanczos interpolant that will be used when performing the
intra-pixel shift.
Default is None, where a predefined value is used for the
interpolant size.</p></li>
<li><p><strong>upfact</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – Upsampling factor; default is None, in which case that of the
MCCD instance will be used.</p></li>
<li><p><strong>mccd_debug</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Debug option. It returns the model plus the local and the global
reconstruction components.
Default is False.</p></li>
<li><p><strong>global_pol_interp</strong> (<em>numpy.ndarray</em>) – If is None, the global interpolation is done with th RBF
interpolation as in the local model.
If is not None, the global interpolation is done directly using
position polynomials.
In this case, <code class="docutils literal notranslate"><span class="pre">global_pol_interp</span></code> should be the normalized Pi
interpolation matrix.
Default is None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>PSFs</strong> – Returns the interpolated PSFs in regular format.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mccd.mccd.MCCD.validation_stars">
<code class="sig-name descname"><span class="pre">validation_stars</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_stars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_pos</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_masks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ccd_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mccd_debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">response_flag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_pol_interp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/mccd/mccd.html#MCCD.validation_stars"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mccd.mccd.MCCD.validation_stars" title="Permalink to this definition">¶</a></dt>
<dd><p>Match PSF model to stars.</p>
<p>The match is done in flux, shift and pixel sampling -
for validation tests.
Returns the matched PSFs’ stamps.
Returned matched PSFs will be None if there is no model on that
specific CCD due to the lack of training stars.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>test_stars</strong> (<em>numpy.ndarray</em>) – Star stamps to be used for comparison with the PSF model.
Should be in “rca” format,
i.e. with axises (n_pixels, n_pixels, n_stars).</p></li>
<li><p><strong>test_pos</strong> (<em>numpy.ndarray</em>) – Their corresponding positions in global coordinate system.</p></li>
<li><p><strong>test_masks</strong> (<em>numpy.ndarray</em>) – Masks to be used on the star stamps.
If None, all the pixels will be used.
Default is None.</p></li>
<li><p><strong>ccd_id</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – The corresponding ccd_id
(ie ccd number corresponding to the megacam geometry).
Do not mistake for ccd_idx (index).</p></li>
<li><p><strong>mccd_debug</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Debug option. It returns the local and the global
reconstruction components.</p></li>
<li><p><strong>response_flag</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – Response option. True if in response mode.</p></li>
<li><p><strong>global_pol_interp</strong> (<em>Position pols of numpy.ndarray</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><em>None</em></a>) – If is None, the global interpolation is done with th RBF
interpolation as in the local model.
If is not None, the global interpolation is done directly
using position polynomials.
In this case, it should be the normalized Pi interpolation matrix.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="mccd.mccd_utils.html" class="btn btn-neutral float-right" title="1.1.5. mccd.mccd_utils module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="mccd.info.html" class="btn btn-neutral float-left" title="1.1.3. mccd.info module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Tobias Liaudat.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>